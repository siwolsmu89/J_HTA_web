<!DOCTYPE html>
<html lang="ko">
<head>
	<title>Bootstrap 4 Template</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<style type="text/css">
		.table tbody td {
			vertical-align: middle;
		}
	</style>
</head>
<body onload="refreshTotalOrderPrice()">
<div class="container">
	
	<div class="row">
		<div class="col-12">
			<ul class="breadcrumb">
				<li class="breadcrumb-item"><a href="#">홈</a></li>
				<li class="breadcrumb-item"><a href="#">메뉴</a></li>
				<li class="breadcrumb-item"><a href="#">서브메뉴</a></li>
				<li class="breadcrumb-item active">장바구니</li>
			</ul>
		</div>
	</div>
	<div class="row">
		<div class="col-12">
			<form>
				<div class="card">
					<div class="card-header">장바구니</div>
					<div class="card-body">
						<!-- 장바구니 테이블 시작 -->
						<table class="table" id="cart-table">
							<colgroup>
								<col width="5%">
								<col width="15%">
								<col width="*">
								<col width="15%">
								<col width="15%">
								<col width="15%">
								<col width="7%">
							</colgroup>
							<thead class="thead-dark">
								<tr>
									<th>
										<div class="form-check-inline">
	  										<label class="form-check-label">
	    										<input type="checkbox" class="form-check-input" id="header-checkbox" checked onchange="toggleAllCheckboxes(event)">
	  										</label>
										</div>
									</th>
									<th></th>
									<th>상품명</th>
									<th class="text-right">가격</th>
									<th class="text-right">구매수량</th>
									<th class="text-right">구매가격</th>
									<th class="text-center"></th>
								</tr>
							</thead>
							<tbody>
								<tr id="row-10001">
									<td>
										<div class="form-check-inline">
	  										<label class="form-check-label">
	    										<input type="checkbox" class="form-check-input" id="product-checkbox-10001" name="no" value="10001" checked onchange="toggleChecked()">
	  										</label>
										</div>
									</td>
									<td><img src="../resources/images/goods/goods1.jpg" class="img-thumbnail "/></td>
									<td>고급 로드자전거</td>
									<td class="text-right"><span id="price-10001">4,000,000</span> 원</td>
									<td class="text-right"><input type="number" class="w-50 text-right" id="amount-10001" value="2" min="1" onchange="changeAmount(10001)"></td>
									<td class="text-right"><strong id="order-price-10001">8,000,000</strong> 원</td>
									<td class="text-center">
										<div class="btn-group-vertical btn-group-sm">
											<button type="button" class="btn btn-danger" onclick="removeProduct(10001)">삭제</button>
											<button type="button" class="btn btn-primary">주문</button>
										</div>
									</td>
								</tr>
								<tr id="row-10004">
									<td>
										<div class="form-check-inline">
	  										<label class="form-check-label">
	    										<input type="checkbox" class="form-check-input" id="product-checkbox-10004" name="no" value="10004" checked onchange="toggleChecked()">
	  										</label>
										</div>
									</td>
									<td><img src="../resources/images/goods/goods1.jpg" class="img-thumbnail"/></td>
									<td>시티형 전기 자전거</td>
									<td class="text-right"><span id="price-10004">1,200,000</span> 원</td>
									<td class="text-right"><input type="number" class="w-50 text-right" id="amount-10004" value="3" min="1" onchange="changeAmount(10004)"></td>
									<td class="text-right"><strong id="order-price-10004">3,600,000</strong> 원</td>
									<td class="text-center">
										<div class="btn-group-vertical btn-group-sm">
											<button type="button" class="btn btn-danger" onclick="removeProduct(10004)">삭제</button>
											<button type="button" class="btn btn-primary">주문</button>
										</div>
									</td>
								</tr>
								<tr id="row-10006">
									<td>
										<div class="form-check-inline">
	  										<label class="form-check-label">
	    										<input type="checkbox" class="form-check-input" id="product-checkbox-10006" name="no" value="10006" checked onchange="toggleChecked()">
	  										</label>
										</div>
									</td>
									<td><img src="../resources/images/goods/goods1.jpg" class="img-thumbnail"/></td>
									<td>하이브리드 출퇴근용 자전거</td>
									<td class="text-right"><span id="price-10006">150,000</span> 원</td>
									<td class="text-right"><input type="number"  class="w-50 text-right" id="amount-10006" value="2" min="1" onchange="changeAmount(10006)"></td>
									<td class="text-right"><strong id="order-price-10006">300,000</strong> 원</td>
									<td class="text-center">
										<div class="btn-group-vertical btn-group-sm">
											<button type="button" class="btn btn-danger" onclick="removeProduct(10006)">삭제</button>
											<button type="button" class="btn btn-primary">주문</button>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
						<!-- 장바구니 테이블 끝 -->
					</div>
					<div class="card-footer">
						<div class="row">
							<div class="col-12 text-right">
								<span class="display-4"><small>결재금액 : </small></span>
								<span class="display-4"><strong class="text-border text-danger" id="total-order-price">0</strong> <small>원</small></span>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
// 전체 선택/해제 체크박스의 체크상태가 변할 때 실행되는 함수
	function toggleAllCheckboxes(event) {
		// 전체 선택/해제 체크박스의 현재 체크여부를 조회한다.(true/false 값 중 하나다.)
		var currentHeaderCheckboxStatus = event.target.checked;
		
		// 모든 상품의 체크박스를 전부 조회한다.(input[id^=product-checkbox]는 input태그 중에서 id가 product-checkbox로 시작하는 엘리먼트를 전부 나타낸다.)
		var checkboxes = document.querySelectorAll('input[id^=product-checkbox]');
		for (var i=0; i<checkboxes.length; i++) {
			var checkbox = checkboxes[i];
			// 상품 체크박스의 체크상태에  전체 선택/해제 체크박스의 현재 체크상태값을 대입한다.
			checkbox.checked = currentHeaderCheckboxStatus;
		}
		
		// 총 결재금액을 계산하는 함수를 실행한다.
		refreshTotalOrderPrice();
	}
	
// 전체 선택/해제 체크박스의 체크상태를 변경한다.(상품 체크박스의 체크상태를 조사해서 전부 체크된 경우에는 자동으로 전체 선택/해제 체크박스가 체크되게 한다.)
	function changeCheckedHeaderCheckbox() {
		// 모든 상품의 체크박스를 전부 조회한다.(input[id^=product-checkbox]는 input태그 중에서 id가 product-checkbox로 시작하는 엘리먼트를 전부 나타낸다.)
		var checkboxes = document.querySelectorAll('input[id^=product-checkbox]');
		
		// 체크되지 않은 체크박스가 있을 경우 true값을 대입할 변수
		var isExistUncheckedCheckbox = false;
		for (var i=0; i<checkboxes.length; i++) {
			var checkbox = checkboxes[i];
			if (!checkbox.checked) {
				// 체크되지 않은 체크박스가 있으면 isExistUncheckedCheckbox에 true를 대입한다.
				isExistUncheckedCheckbox = true;
				break;
			}
		}
		
		// isExistUncheckedCheckbox가 true이면 체크되지 않은 상품체크박스가 하나 이상 있다. --> 전체 선택/해제 체크박스의 체크상태를 false로 바꾼다. ---> isExistUncheckedCheckbox의 반대값을 대입
		// isExistUncheckedCheckbox가 false이면 체크되지 않은 상품체크박스가 하나도 없다. --> 전체 선택/해제 체크박스의 체크상태를 true로 바꾼다. ---> isExistUncheckedCheckbox의 반대값을 대입
		document.getElementById("header-checkbox").checked = !isExistUncheckedCheckbox;
	}
	
// 각 상품 체크박스의 체크상태가 변할 때 실행되는 함수
	function toggleChecked() {
		// 전체 선택/해제 체크박스의 체크상태를 변경한다.
		changeCheckedHeaderCheckbox()
		// 총 결재금액을 계산하는 함수를 실행한다.
		refreshTotalOrderPrice();
	}
	
// 구매수량을 변경할 때 실행되는 함수
	// 구매수량이 변경될 때마다 구매수량이 변경된 상품의 번호를 전달받는다.
	function changeAmount(productNo) {
		// 해당 상품의 가격을 조회한다.
		var price = currencyToNumber(document.getElementById("price-" + productNo).textContent);
		// 해당 상품의 구매수량을 조회한다.
		var amount = parseInt(document.getElementById("amount-" + productNo).value);
		
		// 구매 가격을 계산하고, 구매가격 태그의 텍스트 컨텐츠에 대입한다.
		var orderPrice = price*amount;
		document.getElementById("order-price-" + productNo).textContent = numberToCurrency(orderPrice);
		
		// 총 결재금액을 계산하는 함수를 실행한다.
		refreshTotalOrderPrice();
	}

	
// 삭제버튼을 클릭했을 때 실행되는 함수
	function removeProduct(productNo) {
		// tbody엘리먼트를 조회한다.
		var tbody = document.querySelector("#cart-table tbody");
		// 삭제할 tr 엘리먼트를 조회한다
		var tr = document.getElementById("row-" + productNo);
		tbody.removeChild(tr);
		
		// 전체 선택/해제 체크박스의 체크상태를 변경한다.
		changeCheckedHeaderCheckbox();
		
		// 총 결재금액을 계산하는 함수를 실행한다.
		refreshTotalOrderPrice();
	}
	
// 총 결재금액을 계산하는 함수다.
	// 장바구니의 상품들 중에서 체크박스가 체크된 상품들의 구매가격만 조회해서 총결재금액을 계산한다.
	function refreshTotalOrderPrice() {
		// 모든 상품의 체크박스를 전부 조회한다.(input[id^=product-checkbox]는 input태그 중에서 id가 product-checkbox로 시작하는 엘리먼트를 전부 나타낸다.)
		var checkboxes = document.querySelectorAll('input[id^=product-checkbox]');
		
		// 총 결재금액을 저장할 변수를 선언한다.
		var totalOrderPrice = 0;
		for (var i=0; i<checkboxes.length; i++) {
			var checkbox = checkboxes[i];
			// 각 상품 체크박스의 체크여부를 조회한다.
			if (checkbox.checked) {
				// 체크된 체크박스의 값(상품번호)을 조회한다.( <input type="checkbox" id="product-checkbox-10006" value="10006" /> 에서 value값을 조회하면 해당 상품의 번호를 획득할 수 있다.)
				var productNo = checkbox.value;
				// 해당 상품의 구매가격을 조회한다. ( <strong id="order-price-10006">300,000</strong> 구매가격은 id가 "order-price-상품번호"에 해당하는 엘리먼트의 컨텐츠다.)
				var currencyText = document.getElementById("order-price-" + productNo).textContent
				// 구매가격을 숫자로 변환한다.("300,000"을 300000 으로 변환한다.)
				var orderPrice = currencyToNumber(currencyText);
				// 구매가격을 총 결재금액에 더한다.
				totalOrderPrice += orderPrice;
			}
		}
		// 계산된 총 결재금액을 가격표시로 변환한 다음, 총구매가격 태그의 컨텐츠로 대입한다.
		document.getElementById("total-order-price").textContent = numberToCurrency(totalOrderPrice)
	}
	
// 숫자를 가격텍스트로 변환한다. (1300000 ---> "1,300,000")
	function numberToCurrency(number) {
		return new Number(number).toLocaleString();
	}

// 가격텍스트를 숫자로 변환한다.("1,300,000" ---> 1300000)
	function currencyToNumber(currency) {
		return parseInt(currency.replace(/,/g, ''));
	}
</script>
</body>
</html>